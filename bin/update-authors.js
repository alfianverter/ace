/*
  update-authors.js by Aceheliflyer
  This script automatically updates `AUTHORS.md` based on Git commit history.

  Based on ShellScript version by feross:
  http://github.com/standard/standard/blob/a5994268773a1c12d9e1e23c786ed8f7e90d41e5/bin/update-authors.sh#L4-L24
*/
process.chdir(__dirname)
const { stripIndents } = require('common-tags')
const moment = require('moment')
const fs = require('fs')
var text = ''
var seen = []

// Header text.
text += stripIndents`
  # Project Authors

  #### Ordered by first contribution.

  > Last Updated ${moment(new Date()).format('YYYY/MM/DD HH:mm:SS')}
`
text += '\n\n'

require('child_process')
  .execSync('git log --reverse --format="**%aN** (%aE)"')
  .toString()
  .split('\n')
  .forEach(author => {
    if (seen.includes(author) || author === '') return
    seen.push(author)
    text += `- ${author}\n`
  })
text += '\n'

// Footer text.
text += '---\n\n#### Generated by `bin/update-authors.js`. ðŸš€'

// eol-last
text += '\n'

// Write to file.
fs.writeFile(`${process.cwd()}/../AUTHORS.md`, text, (error) => {
  if (error) {
    console.error(error)
    process.exit(1)
  } else {
    process.exit(0)
  }
})
